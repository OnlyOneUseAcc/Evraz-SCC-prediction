# Легирование сталей
# Прогнозирование химического состава шлака
 В данной работе мы изучили данные физико-химического процесса легирования сталей и создали алгоритм определения химического состава шлака по исходным данным.
## План работ
### 1. Сделать EDA (exploratory data analysis):
 * Пропуски
 * Выбросы
 * Дисперсия

### 2. Чистка датасета 
* Убрать ненужные столбцы:
    * Несущие бесполезную информацию (Например, признак "nplv")
    * Сильно коррелирующие с другими (Например, признаки "t обработка" и "t продувка"; "t под током" и "эл. энергия")
* Удалить строки содержащие малое количество информации
* Удалить строки, в которых значения таргета неизвестно
* Удаление шумов (выбросов) с помощью IsolationForest

### 3. Заполнение пропущенных значений
* Заполнение с помощью метода MICE (Multiple Imputation by Chained Equations)
![Image](source/qual/nan.png?raw=true)

### 4. Нормализация вещественных признаков
### 5. Разбиение датасета  на обучающую и тестовую выборки
### 6. Выбор модели для прогнозирования
* Была выдвинута и подтверждена теория, что одну целевую переменную можно предсказывать основываясь на других
* Нами было принято решение использовать GradientBoostingRegressor

### 7. Подбор гиперпараметров модели
* Подбор гиперпаметров происходил по n_estimators и lr (learning rate). Эти параметры являются важнейшими для GBR
### 8. Обучение модели на обучающей выборке
* Мы обучали 4 модели для каждого таргета. Для этого создали 4 датасета, каждый из которых включал в себя помимо первоначальных признаков, 3 оставшихся таргета. Мы выбрали данный подход, так как заметили сильную корреляцию между целевыми переменными на этапе обработки данных.
### 9. Получение предсказаний модели на тестовой выборке по самой популярной марки
Были получены следующие результаты для таргетов:
* химшлак последний Al2O3
  * <img src="https://render.githubusercontent.com/render/math?math=r^{2}\  score = 0.625318310066501">
   ![Image](source/qual/f_i_химшлак_последний_Al2O3.png?raw=true)
* химшлак последний CaO 
  * <img src="https://render.githubusercontent.com/render/math?math=r^{2}\  score = 0.9165382003515771">
  ![Image](source/qual/f_i_химшлак_последний_CaO.png?raw=true)
* химшлак последний R
  * <img src="https://render.githubusercontent.com/render/math?math=r^{2}\  score = 0.9558793235458077">
  ![Image](source/qual/f_i_химшлак_последний_R.png?raw=true)
* химшлак последний SiO2
  * <img src="https://render.githubusercontent.com/render/math?math=r^{2}\  score = 0.9404653019707947">
  ![Image](source/qual/f_i_химшлак_последний_SiO2.png?raw=true)
  ![Image](source/qual/prediction_result.png?raw=true)
## Описание репозитория
Репозиторий содержит в себе папку src, где хранятся папки для отборочного и финального тура. EDA.ipynb содержит в себе выполнение пунктов  1-6, GBR.ipynb выполнение пунктов 7-9.
Каталог data содержит исходный датасет, и полученные в результате выполнения EDA.ipynb обучающую и тестовую выборки.
Каталог source содержит графики, полученные при анализе данных.
## Выводы по EDA
* График распределения целевой переменной "химшлак последний Al2O3"
![Image](source/qual/target_range_1.png?raw=true)
* График распределения целевой переменной "химшлак последний CaO"
![Image](source/qual/target_range_2.png?raw=true)
* График распределения целевой переменной "химшлак последний R"
![Image](source/qual/target_range_3.png?raw=true)
* График распределения целевой переменной "химшлак последний SiO2"
![Image](source/qual/target_range_4.png?raw=true)
* График корреляций между признаками
![Image](source/qual/correletion_map.png?raw=true)
* График корреляции между таргетами
![Image](source/qual/correletion_map_target.png?raw=true)
* Дисперсия признакового пространства до обработки 
![Image](source/qual/dispersion_bar_preprocessing.png?raw=true)
* Дисперсия признакового пространства после обработки
![Image](source/qual/dispersion_bar_postprocessing.png?raw=true)

## Финальный тур
* График корреляции между целевой переменной и признаками
![Image](source/final_stage/correlation_target_map.png?raw=true)
* График предсказанных значений, используя LinearRegression
![Image](source/final_stage/linear_prediction.png?raw=true)
* График предсказанных значений, используя GBR
![Image](source/final_stage/GBR_prediction.png?raw=true)
* График предсказанных значений, используя CatBoostRegressor
![Image](source/final_stage/CatBoost_prediction.png?raw=true)
  
## Обертка
Мы обернули обученную модель в чат-бота Telegram. О нем вы можете узнать больше,
посетив [эту страницу](https://github.com/Vas9ka/Evraz_predict_bot)